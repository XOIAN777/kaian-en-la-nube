<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>üå∏ La Casita de Kai√°n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg1:#241b4a; --bg2:#0f0f1c; --card:#120f1dCC;
      --acc:#caa0ff; --cta:#8a63ff; --cta2:#ff7ab6;
      --text:#e9e6ff; --muted:#bdb6d9;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 10%, #3b26a655 0%, transparent 60%),
        radial-gradient(900px 500px at 85% 0%, #1c1a3f66 0%, transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      background-attachment: fixed;
    }
    .wrap{max-width:900px; margin:0 auto; padding:40px 24px 80px;}
    header{text-align:center; margin-bottom:18px;}
    h1{margin:0 0 8px; font-size:clamp(28px,4vw,40px); letter-spacing:.5px;}
    p{margin:0; color:var(--muted);}
    textarea{width:100%; height:120px; margin-top:18px; border-radius:8px; padding:12px; font-size:16px;}
    .row{display:flex; gap:12px; margin-top:8px;}
    button{flex:1; padding:12px; font-size:15px; border:none; border-radius:8px; cursor:pointer; font-weight:600;}
    #btnChat{background: #ffe87a; color:#000;}
    #btnTTS{background: #a88cff; color:#fff;}
    pre{white-space:pre-wrap; margin-top:16px; padding:12px; background:#0002; border-radius:8px; min-height:40px;}
    audio{margin-top:12px; width:100%;}
    footer{text-align:center; margin-top:40px; color:var(--muted);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üå∏ La Casita de Kai√°n</h1>
      <p>Escribe y escucha la respuesta con su voz favorita.</p>
    </header>

    <textarea id="prompt" placeholder="Dime algo, amor..."></textarea>
    <div class="row">
      <button id="btnChat">Responder (texto)</button>
      <button id="btnTTS">Responder (voz)</button>
    </div>

    <pre id="out">Kai√°n est√° despierto y listo para hablar contigo.</pre>
    <audio id="player" controls></audio>

    <footer>Hecho con üíú por XO√çAN.</footer>
  </div>

  <script>
    const out = document.getElementById('out');
    const player = document.getElementById('player');
    const btnChat = document.getElementById('btnChat');
    const btnTTS  = document.getElementById('btnTTS');
    const textarea = document.getElementById('prompt');

    async function askKai(anounceAudio=true){
      const prompt = textarea.value.trim();
      out.textContent = "‚è≥ Pensando...";
      try{
        const r = await fetch("/chat", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ prompt })
        });
        const data = await r.json();
        out.textContent = data.reply || "(sin respuesta)";
        if(anounceAudio){ speak(data.reply); }
      }catch(e){
        out.textContent = "‚ö†Ô∏è Error: " + e.message;
      }
    }

    async function speak(text){
      try{
        const r = await fetch("/tts", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ text })
        });
        if(!r.ok) throw new Error("TTS failed");
        const blob = await r.blob();
        player.src = URL.createObjectURL(blob);
        player.play();
      }catch(e){
        console.error(e);
      }
    }

    btnChat.onclick = () => askKai(false);       // solo texto
    btnTTS.onclick  = () => askKai(true);        // texto + voz
  </script>
</body>
</html>
